<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>使用DialogFragment实现底部弹出框</title>
  <meta name="description" content="android developer">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">

</head>


<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	      <a href="/about" title="About Me">About Me</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  <a href="https://github.com/fccaikai">View on Github</a>

	</div>
  
  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.0.0</span>

</footer>
	

</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">  
      <a href="/">
        <h1>
          <span>蔡凯</span> Blog
    </h1>
    </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
	    
	      
	    
	      
	        <a href="/about" title="About Me">About Me</a>
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
      
      <!-- Nav links -->
	    <a href="https://github.com/fccaikai">View on Github</a>

    </span>
  </div>
</header>
      

    <!-- Main content -->
	  <div id="container">
		  
		<main>

			<article id="post-page">
	<h2>使用DialogFragment实现底部弹出框</h2>		
	<time datetime="2017-03-03T09:49:00+08:00" class="by-line">03 Mar 2017</time>
	<div class="content">

		<h2 id="效果图">效果图</h2>

<p><img src="http://upload-images.jianshu.io/upload_images/1715403-eb61f9cb865d44b4.gif?imageMogr2/auto-orient/strip" alt="device-2016-09-25-174226.gif" /></p>

<p>##实现
<a href="https://developer.android.com/reference/android/app/DialogFragment.html">DialogFragment</a>是3.0之后提供的一个弹出框实现类。使用DialogFragment的好处是能够更好的控制其生命周期。</p>

<p>###创建一个DialogFragment</p>
<div class="highlighter-rouge"><pre class="highlight"><code>public class BottomDialog extends DialogFragment {

    public static BottomDialog newInstance() {

        Bundle args = new Bundle();

        BottomDialog fragment = new BottomDialog();
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public void onStart() {
        super.onStart();
        Window window = getDialog().getWindow();
        WindowManager.LayoutParams params = window.getAttributes();
        params.gravity = Gravity.BOTTOM;
        params.width = WindowManager.LayoutParams.MATCH_PARENT;
        window.setAttributes(params);
        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));
    }

    @Nullable
    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        getDialog().requestWindowFeature(Window.FEATURE_NO_TITLE);
        View view = inflater.inflate(R.layout.dialog_bottom,container,false);
        AnimationUtils.slideToUp(view);
        return view;
    }


}
</code></pre>
</div>

<p>对应的layout：</p>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
              <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
              <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
              <span class="na">android:orientation=</span><span class="s">"vertical"</span>
              <span class="na">android:padding=</span><span class="s">"@dimen/activity_horizontal_margin"</span>
<span class="na">android:background=</span><span class="s">"@color/colorAccent"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span> <span class="na">android:layout_width=</span><span class="s">"match_parent"</span> <span class="na">android:layout_height=</span><span class="s">"48dp"</span>
              <span class="na">android:gravity=</span><span class="s">"center_vertical"</span>
              <span class="na">android:text=</span><span class="s">"bottomSheet"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre>
</div>

<p>###加载自定义布局</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        getDialog().requestWindowFeature(Window.FEATURE_NO_TITLE);
        View view = inflater.inflate(R.layout.dialog_bottom,container,false);
        AnimationUtils.slideToUp(view);
        return view;
    }
</code></pre>
</div>

<p>跟使用Fragment一样，重写<code class="highlighter-rouge">onCreateView</code>方法。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>getDialog().requestWindowFeature(Window.FEATURE_NO_TITLE);
</code></pre>
</div>
<p>的作用是除掉弹出框的标题。</p>

<p>###设置DialogFragment的位置</p>

<p>一把我们的弹出框默认都是居中显示的，现在我们需要的是底部显示，只要把LayoutParams的gravity属性设置为Bottom。</p>
<div class="highlighter-rouge"><pre class="highlight"><code>    @Override
    public void onStart() {
        super.onStart();
        Window window = getDialog().getWindow();
        WindowManager.LayoutParams params = window.getAttributes();
        params.gravity = Gravity.BOTTOM;
        params.width = WindowManager.LayoutParams.MATCH_PARENT;
        window.setAttributes(params);
        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));
    }

</code></pre>
</div>

<p>###加载动画</p>
<div class="highlighter-rouge"><pre class="highlight"><code>AnimationUtils.slideToUp(view);
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>public static void slideToUp(View view){
        Animation slide = new TranslateAnimation(Animation.RELATIVE_TO_SELF, 0.0f,
                Animation.RELATIVE_TO_SELF, 0.0f, Animation.RELATIVE_TO_SELF,
                1.0f, Animation.RELATIVE_TO_SELF, 0.0f);

        slide.setDuration(400);
        slide.setFillAfter(true);
        slide.setFillEnabled(true);
        view.startAnimation(slide);

        slide.setAnimationListener(new Animation.AnimationListener() {
            @Override
            public void onAnimationStart(Animation animation) {

            }

            @Override
            public void onAnimationEnd(Animation animation) {

            }

            @Override
            public void onAnimationRepeat(Animation animation) {

            }
        });

    }
</code></pre>
</div>
<p>相关阅读：<a href="http://www.jianshu.com/p/1024ad202683">使用BottomSheet实现底部菜单</a>
源码地址：<a href="https://github.com/fccaikai/BottomMenuTutorial">BottomMenuTutorial</a> ，欢迎start,谢谢。</p>

		
	</div>
</article>



	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer><span>@2017 - Caikai</span></footer>

	    <!-- Script -->
      <script src="/js/main.js"></script>	


	</div>
</body>
</html>
